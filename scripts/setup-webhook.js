const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();

async function setupWebhook() {
  const bot = new TelegramBot(process.env.BOT_TOKEN, { polling: false });
  
  try {
    // URL –≤–µ–±—Ö—É–∫–∞ –Ω–∞ Vercel
    const webhookUrl = process.env.WEBHOOK_URL || 'https://your-app-name.vercel.app/api/webhook';
    
    console.log('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞...');
    console.log(`üì° URL: ${webhookUrl}`);
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–µ–±—Ö—É–∫
    const result = await bot.setWebhook(webhookUrl);
    
    if (result) {
      console.log('‚úÖ –í–µ–±—Ö—É–∫ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
      
      // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ–±—Ö—É–∫–µ
      const webhookInfo = await bot.getWebhookInfo();
      console.log('üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ–±—Ö—É–∫–µ:');
      console.log(`   URL: ${webhookInfo.url}`);
      console.log(`   –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: ${webhookInfo.last_error_message || '–ù–µ—Ç'}`);
      console.log(`   –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${webhookInfo.last_error_date || '–ù–µ—Ç'}`);
    } else {
      console.log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤–µ–±—Ö—É–∫–∞');
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞:', error.message);
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É
setupWebhook();
